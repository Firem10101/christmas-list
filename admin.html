<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Christmas List Admin</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    background: url('https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.farmersalmanac.com%2Fwp-content%2Fuploads%2F2020%2F12%2FChristmas-Day-traditions-as_301005745.jpeg&f=1&nofb=1&ipt=5fec5f3eb60804cbac6eca77e3c7e28cc891b8d7a68c09544289a484bcb9bf56') no-repeat center center fixed;
    background-size: cover;
    color: #fff;
  }

  h1 {
    text-align: center;
    text-shadow: 2px 2px 4px #000;
    margin-top: 20px;
  }

  #list {
    max-width: 800px;
    margin: 20px;
    padding: 10px;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 15px;
  }

  img {
    max-width: 100px;
    margin-right: 5px;
    border-radius: 5px;
  }

  .item {
    border: 2px solid #fff;
    border-radius: 10px;
    padding: 5px;
    margin: 10px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: rgba(255, 0, 0, 0.3);
    transition: transform 0.2s, background-color 0.2s;
    cursor: grab;
  }

  .item:hover {
    transform: scale(1.03);
    background-color: rgba(0, 128, 0, 0.3);
  }

  button {
    padding: 5px 10px;
    background-color: gold;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s;
    margin-left: 5px;
  }

  button:hover {
    background-color: #ffa500;
  }

  input, textarea {
    padding: 5px;
    margin: 5px 0;
    border-radius: 5px;
    border: 1px solid #ccc;
    width: 100%;
  }

  textarea {
    resize: vertical;
    min-height: 60px;
    white-space: pre-wrap;
    font-family: inherit;
  }

  #admin-panel {
    position: fixed;
    top: 0;
    right: 0;
    width: 300px;
    height: 100%;
    background-color: rgba(0,0,0,0.8);
    padding: 20px;
    overflow-y: auto;
    box-shadow: -5px 0 10px rgba(0,0,0,0.5);
  }
</style>
</head>
<body>

<h1>Admin Panel - Manage Christmas List</h1>

<div id="list"></div>

<div id="admin-panel">
  <h2>Add / Edit Item</h2>
  <input type="text" id="item-name" placeholder="Item Name">
  <input type="text" id="item-price" placeholder="Price">
  <textarea id="item-description" placeholder="Description (optional)"></textarea>
  <input type="text" id="item-link" placeholder="Item Link (optional)">
  <input type="file" id="item-image">
  <button id="add-btn" onclick="addItem()">Add Item</button>
  <button id="update-btn" style="display:none;" onclick="updateItem()">Update Item</button>
</div>

<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyARtsrEkiRqyxEv6KfdC48TJt1RCcZZ_Kg",
    authDomain: "christmas-list-9a41e.firebaseapp.com",
    databaseURL: "https://christmas-list-9a41e-default-rtdb.firebaseio.com",
    projectId: "christmas-list-9a41e",
    storageBucket: "christmas-list-9a41e.appspot.com",
    messagingSenderId: "590904557299",
    appId: "1:590904557299:web:d6989710fe9049637fc186"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const itemsRef = db.ref('items');
  let editingKey = null;


  itemsRef.on('value', snapshot => {
    const data = snapshot.val();
    const items = data ? Object.entries(data).map(([key, value]) => ({ key, ...value })) : [];
    renderList(items);
  });

  function renderList(items) {
    const listDiv = document.getElementById('list');
    listDiv.innerHTML = '';

    items.forEach(item => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'item';
        itemDiv.draggable = true;
        itemDiv.dataset.key = item.key; // <-- ADD THIS

        // Image
        if (item.image) {
        const img = document.createElement('img');
        img.src = item.image;
        itemDiv.appendChild(img);
        }

        // Name, price, description, link
        const textDiv = document.createElement('div');
        textDiv.innerHTML = `<strong>${item.name}</strong><br>$${item.price}<br><pre style="white-space: pre-wrap; margin:0;">${item.description || ''}</pre>${item.link ? `<br><a href="${item.link}" target="_blank" style="color:gold;">Link</a>` : ''}`;
        itemDiv.appendChild(textDiv);

        // Buttons
        const buttonsDiv = document.createElement('div');
        buttonsDiv.style.display = 'flex';
        buttonsDiv.style.gap = '5px';

        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'Remove';
        removeBtn.onclick = () => itemsRef.child(item.key).remove();
        buttonsDiv.appendChild(removeBtn);

        const editBtn = document.createElement('button');
        editBtn.textContent = 'Edit';
        editBtn.onclick = () => editItem(item.key, item.name, item.price, item.image, item.description, item.link); // pass link
        buttonsDiv.appendChild(editBtn);

        itemDiv.appendChild(buttonsDiv);
        listDiv.appendChild(itemDiv);

        // Drag-and-drop events
        itemDiv.addEventListener('dragstart', handleDragStart);
        itemDiv.addEventListener('dragover', handleDragOver);
        itemDiv.addEventListener('dragleave', handleDragLeave);
        itemDiv.addEventListener('drop', handleDrop);
        itemDiv.addEventListener('dragend', handleDragEnd);
    });
    }

  function addItem() {
  if (!isAdmin) return alert("Only admin can add items!");

  const name = document.getElementById('item-name').value;
  const price = document.getElementById('item-price').value;
  const link = document.getElementById('item-link').value;
  const imageInput = document.getElementById('item-image');

  if (!name || !price) return alert('Please enter name and price');

  const reader = new FileReader();
  reader.onload = function(e) {
    const newItem = { 
      name, 
      price, 
      image: e.target.result, 
      link, 
      order: Date.now() // use timestamp for initial order
    };
    itemsRef.push(newItem);
  };

  if (imageInput.files[0]) {
    reader.readAsDataURL(imageInput.files[0]);
  } else {
    const newItem = { 
      name, 
      price, 
      image: '', 
      link, 
      order: Date.now() 
    };
    itemsRef.push(newItem);
  }

  // Clear inputs
  document.getElementById('item-name').value = '';
  document.getElementById('item-price').value = '';
  document.getElementById('item-link').value = '';
  imageInput.value = '';
}

  function editItem(key, currentName, currentPrice, currentImage, currentDescription, currentLink) {
    editingKey = key;
    document.getElementById('item-name').value = currentName;
    document.getElementById('item-price').value = currentPrice;
    document.getElementById('item-description').value = currentDescription || '';
    document.getElementById('item-link').value = currentLink || ''; // populate link
    document.getElementById('add-btn').style.display = 'none';
    document.getElementById('update-btn').style.display = 'block';
    }

  function updateItem() {
    if (!editingKey) return;

    const name = document.getElementById('item-name').value;
    const price = document.getElementById('item-price').value;
    const description = document.getElementById('item-description').value;
    const link = document.getElementById('item-link').value; // get link
    const imageInput = document.getElementById('item-image');

    if (!name || !price) return alert('Please enter name and price');

    const updatedItem = { name, price, description, link, image: '' }; // include link

    if (imageInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
        updatedItem.image = e.target.result;
        itemsRef.child(editingKey).set(updatedItem);
        resetAdminPanel();
        };
        reader.readAsDataURL(imageInput.files[0]);
    } else {
        itemsRef.child(editingKey).once('value', snapshot => {
        const oldItem = snapshot.val();
        updatedItem.image = oldItem.image;
        itemsRef.child(editingKey).set(updatedItem);
        resetAdminPanel();
        });
    }
  }

  function resetAdminPanel() {
    document.getElementById('item-name').value = '';
    document.getElementById('item-price').value = '';
    document.getElementById('item-description').value = '';
    document.getElementById('item-image').value = '';
    document.getElementById('add-btn').style.display = 'block';
    document.getElementById('update-btn').style.display = 'none';
    editingKey = null;
  }

  // Drag & Drop handlers

  let dragIcon = null;

  function handleDragStart(e) {
    dragSrcEl = this;
    this.style.opacity = '0.5';

    // Create a clone for drag image
    dragIcon = this.cloneNode(true);
    dragIcon.style.position = 'absolute';
    dragIcon.style.top = '-1000px'; 
    dragIcon.style.left = '-1000px';
    dragIcon.style.width = this.offsetWidth + 'px';
    dragIcon.style.pointerEvents = 'none';
    dragIcon.style.boxShadow = '0 0 10px rgba(0,0,0,0.5)';
    document.body.appendChild(dragIcon);

    e.dataTransfer.setDragImage(dragIcon, e.offsetX, e.offsetY);
}


  function handleDragOver(e) {
    e.preventDefault();
    if (this !== dragSrcEl) this.style.backgroundColor = 'rgba(0,128,0,0.3)';
  }

  function handleDragLeave(e) {
    if (this !== dragSrcEl) this.style.backgroundColor = '';
  }

  function handleDrop(e) {
  e.stopPropagation();
  if (dragSrcEl !== this) {
    const listDiv = document.getElementById('list');
    const children = Array.from(listDiv.children);
    const srcIndex = children.indexOf(dragSrcEl);
    const destIndex = children.indexOf(this);

    if (srcIndex < destIndex) {
      listDiv.insertBefore(dragSrcEl, this.nextSibling);
    } else {
      listDiv.insertBefore(dragSrcEl, this);
    }

    // Update Firebase order
    Array.from(listDiv.children).forEach((child, index) => {
      const key = child.dataset.key;
      if (key) {
        itemsRef.child(key).update({ order: index });
      }
    });
  }
  this.style.backgroundColor = '';
}


  function handleDragEnd(e) {
    this.style.opacity = '1';
    const listDiv = document.getElementById('list');
    Array.from(listDiv.children).forEach(child => child.style.backgroundColor = '');
    
    if (dragIcon) {
        document.body.removeChild(dragIcon);
        dragIcon = null;
    }
}

</script>
</body>
</html>
