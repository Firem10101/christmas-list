<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Christmas List</title>

  <style>
    /* ===== Base Styles ===== */
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: url('https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.farmersalmanac.com%2Fwp-content%2Fuploads%2F2020%2F12%2FChristmas-Day-traditions-as_301005745.jpeg&f=1&nofb=1&ipt=5fec5f3eb60804cbac6eca77e3c7e28cc891b8d7a68c09544289a484bcb9bf56') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
    }

    h1, h2 {
      text-align: center;
      text-shadow: 2px 2px 4px #000;
    }

    /* ===== List Container ===== */
    #list {
      max-width: 800px;
      margin: 20px;
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 15px;
    }

    /* ===== Item Cards ===== */
    .item {
      border: 2px solid #fff;
      border-radius: 10px;
      padding: 10px;
      margin: 10px 0;
      display: flex;
      align-items: center;
      background-color: rgba(255, 0, 0, 0.3);
      transition: transform 0.2s;
    }

    .item:hover {
      transform: scale(1.03);
      background-color: rgba(0, 128, 0, 0.3);
    }

    /* ===== Images ===== */
    img {
      max-width: 100px;
      margin-right: 15px;
      border-radius: 10px;
    }

    .item img {
      transition: transform 0.2s;
    }

    .item img:hover {
      transform: scale(1.2);
      cursor: zoom-in;
    }

    /* ===== Buttons & Inputs ===== */
    button {
      margin-left: auto;
      padding: 5px 10px;
      background-color: gold;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #ffa500;
    }

    input {
      padding: 5px;
      margin: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    h2 {
      margin-top: 40px;
    }

    /* ===== Snow Effect ===== */
    #snow {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }

    .snowflake {
      position: absolute;
      top: -10px;
      color: white;
      font-size: 1em;
      user-select: none;
      pointer-events: none;
      animation-name: fall;
      animation-timing-function: linear;
    }

    @keyframes fall {
      to { transform: translateY(100vh); }
    }

    /* ===== Admin Panels ===== */
    #admin-login, 
    #admin-section {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: rgba(0,0,0,0.7);
      padding: 10px;
      border-radius: 10px;
      max-width: 250px;
      font-size: 0.9em;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      z-index: 10000;
    }

    #admin-login input, 
    #admin-section input {
      width: 100%;
      font-size: 0.9em;
      margin: 5px 0;
    }

    #admin-login button, 
    #admin-section button {
      width: 100%;
      font-size: 0.9em;
      padding: 5px;
    }

    /* ===== Lightbox Overlay ===== */
    #lightbox {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }

    #lightbox img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 10px;
      box-shadow: 0 0 15px #000;
    }

    #lightbox-close {
      position: absolute;
      top: 20px;
      right: 40px;
      color: #fff;
      font-size: 40px;
      cursor: pointer;
    }

    /* ===== Description Overlay ===== */
    #desc-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10001;
    }

    #desc-box {
      background: rgba(255,255,255,0.95);
      color: #000;
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
      text-align: center;
      position: relative;
    }

    #desc-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }

    .description-text {
      font-style: italic;
      text-decoration: underline;
      color: #fff;
      background: none;
      border: none;
      cursor: pointer;
      margin-left: 10px;
      font-size: 0.9em;
    }

    .description-text:hover {
      color: #ff0;
    }

    #desc-content pre {
        white-space: pre-wrap;
        word-wrap: break-word;
        color: black;
        font-size: 1em;
        font-family: inherit;
        margin: 0;
    }

  </style>
</head>

<body>
  <div id="snow"></div>

  <h1>Brandon's Birthday / Christmas List</h1>

  <!-- ===== Admin Login ===== -->
  <div id="admin-login">
    <input type="password" id="admin-password" placeholder="Admin Password">
    <button onclick="toggleAdmin()">Enter Admin Mode</button>
  </div>

  <!-- ===== Admin Section ===== -->
  <div id="admin-section" style="display: none;">
    <h2>Add New Item</h2>
    <input type="text" id="item-name" placeholder="Item Name">
    <input type="text" id="item-price" placeholder="Price">
    <input type="file" id="item-image">
    <button onclick="addItem()">Add Item</button>
    <button id="exit-admin-btn" onclick="exitAdmin()">Exit Admin Mode</button>
  </div>

  <!-- ===== Public List ===== -->
  <div id="list"></div>

  <!-- ===== Firebase SDKs ===== -->
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-database-compat.js"></script>

  <!-- ===== Lightbox Overlay ===== -->
  <div id="lightbox" style="display:none;">
    <span id="lightbox-close">&times;</span>
    <img id="lightbox-img" src="">
  </div>

  <!-- Description Overlay -->
    <div id="desc-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background-color: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000;">
    <div id="desc-box" style="background-color:white; padding:20px; border-radius:10px;
        max-width:400px; width:90%; text-align:left;">
        <!-- Main description box -->
        <div id="desc-content" style="margin-bottom:10px; border:1px solid #ccc; padding:10px;
        border-radius:5px; background-color:#f8f8f8; white-space:pre-wrap; word-wrap:break-word;"></div>
        
        <!-- Link box -->
        <div id="desc-link" style="border:1px solid #ccc; padding:10px; border-radius:5px;
        background-color:#eef; text-align:center;"></div>

        <button onclick="closeDescOverlay()" style="margin-top:10px; padding:5px 10px;">Close</button>
    </div>
    </div>

        <!-- Claim Modal -->
<div id="claim-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:10002;">
  <div style="background:#fff; color:#000; padding:20px; border-radius:10px; max-width:350px; width:90%; position:relative;">
    <h2>Claim Item</h2>
    <p>Please enter your information:</p>
    
    <input type="text" id="claim-first-name" placeholder="First Name" style="width:95%; margin-bottom:10px; padding:5px;"><br>
    <input type="text" id="claim-last-name" placeholder="Last Name" style="width:95%; margin-bottom:10px; padding:5px;"><br>
    
    <label style="display:flex; align-items:center; margin-bottom:15px;">
      <input type="checkbox" id="claim-confirm" style="margin-right:10px;">
      <span>by checking this box you agree to claim this item</span>
    </label>
    
    <div style="display:flex; justify-content:flex-end; gap:10px; position:absolute; bottom:20px; right:20px; width:auto;">
  <button id="claim-confirm-btn" disabled style="opacity:0.5;">Claim</button>
  <button id="claim-cancel-btn">Cancel</button>
    </div>
  </div>
</div>

  <script>
    /* ===== Firebase Configuration ===== */
    const firebaseConfig = {
      apiKey: "AIzaSyARtsrEkiRqyxEv6KfdC48TJt1RCcZZ_Kg",
      authDomain: "christmas-list-9a41e.firebaseapp.com",
      databaseURL: "https://christmas-list-9a41e-default-rtdb.firebaseio.com",
      projectId: "christmas-list-9a41e",
      storageBucket: "christmas-list-9a41e.appspot.com",
      messagingSenderId: "590904557299",
      appId: "1:590904557299:web:d6989710fe9049637fc186"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let isAdmin = false;

    // Reference to database node
    const itemsRef = db.ref('items');

    /* ===== Realtime Firebase Sync ===== */
    itemsRef.on('value', snapshot => {
        const data = snapshot.val();
        const items = data ? Object.entries(data).map(([key, value]) => ({ key, ...value })) : [];
        // Sort explicitly by order
        items.sort((a, b) => (a.order ?? 0) - (b.order ?? 0));
        renderList(items);
        });

    /* ===== Render Items ===== */
    function renderList(items) {
      const listDiv = document.getElementById('list');
      listDiv.innerHTML = '';

      items.forEach((item) => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'item';

        const img = document.createElement('img');
        img.src = item.image || '';
        itemDiv.appendChild(img);

        // Lightbox open
        img.addEventListener('click', () => {
          lightbox.style.display = 'flex';
          lightboxImg.src = img.src;
        });

        const text = document.createElement('div');
        text.innerHTML = `<strong>${item.name}</strong><br>$${item.price}`;
        itemDiv.appendChild(text);

        // Description button
        const descBtn = document.createElement('button');
        descBtn.className = 'description-text';
        descBtn.textContent = 'description';
        descBtn.onclick = () => {
    const desc = item.description || 'No description available.';
    const linkMatch = desc.match(/https?:\/\/\S+/); // find a link if one exists

    // Fill main description box
    document.getElementById('desc-content').innerHTML = `<pre>${desc}</pre>`;

    // Fill link box
    const linkBox = document.getElementById('desc-link');
    if (item.link) {
        linkBox.innerHTML = `<a href="${item.link}" target="_blank">${item.link}</a>`;
    } else {
        const linkMatch = desc.match(/https?:\/\/\S+/); // fallback to parsing text
        if (linkMatch) {
            linkBox.innerHTML = `<a href="${linkMatch[0]}" target="_blank">${linkMatch[0]}</a>`;
        } else {
            linkBox.innerHTML = '<em>No link provided</em>';
        }
    }

    // Show the overlay
    document.getElementById('desc-overlay').style.display = 'flex';
};
        itemDiv.appendChild(descBtn);

        // Claim button
        const button = document.createElement('button');
        button.textContent = 'Claim';
        button.onclick = () => {
          openClaimModal();
        };
        itemDiv.appendChild(button);

        listDiv.appendChild(itemDiv);
      });
    }

    /* ===== Add New Item ===== */
    function addItem() {
      if (!isAdmin) return alert("Only admin can add items!");
      const name = document.getElementById('item-name').value;
      const price = document.getElementById('item-price').value;
      const imageInput = document.getElementById('item-image');

      if (!name || !price) return alert('Please enter name and price');

      const reader = new FileReader();
      reader.onload = function(e) {
        const newItem = { name, price, image: e.target.result };
        itemsRef.push(newItem);
      };

      if (imageInput.files[0]) {
        reader.readAsDataURL(imageInput.files[0]);
      } else {
        const newItem = { name, price, image: '' };
        itemsRef.push(newItem);
      }

      document.getElementById('item-name').value = '';
      document.getElementById('item-price').value = '';
      imageInput.value = '';
    }

    /* ===== Admin Login Handling ===== */
    function toggleAdmin() {
      const passwordInput = document.getElementById('admin-password');
      const adminButton = document.querySelector('#admin-login button');
      const password = passwordInput.value;

      if (password === '0825') {
        isAdmin = true;
        window.location.href = 'admin.html';
      } else {
        const originalColor = adminButton.style.backgroundColor;
        const originalText = adminButton.textContent;

        adminButton.style.backgroundColor = 'red';
        adminButton.textContent = 'Wrong password';

        setTimeout(() => {
          adminButton.style.backgroundColor = originalColor || 'gold';
          adminButton.textContent = originalText;
        }, 500);
      }
    }

    /* ===== Snow Animation ===== */
    function createSnowflake() {
      const snowflake = document.createElement('div');
      snowflake.className = 'snowflake';
      snowflake.style.left = Math.random() * window.innerWidth + 'px';
      snowflake.style.fontSize = (Math.random() * 10 + 10) + 'px';
      snowflake.style.opacity = Math.random();
      snowflake.style.animationDuration = (Math.random() * 5 + 5) + 's';
      snowflake.textContent = '❄';
      document.getElementById('snow').appendChild(snowflake);

      setTimeout(() => snowflake.remove(), 10000);
    }

    setInterval(createSnowflake, 200);

    function exitAdmin() {
      isAdmin = false;
      document.getElementById('admin-section').style.display = 'none';
      document.getElementById('admin-login').style.display = 'block';
    }

    /* ===== Lightbox Controls ===== */
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    const lightboxClose = document.getElementById('lightbox-close');

    lightboxClose.addEventListener('click', () => lightbox.style.display = 'none');

    lightbox.addEventListener('click', e => {
      if (e.target === lightbox) lightbox.style.display = 'none';
    });

    /* ===== Description Overlay Controls ===== */
    document.getElementById("desc-close").addEventListener("click", () => {
      document.getElementById("desc-overlay").style.display = "none";
    });

    window.addEventListener("click", (e) => {
      const overlay = document.getElementById("desc-overlay");
      if (e.target === overlay) overlay.style.display = "none";
    });

    function closeDescOverlay() {
        document.getElementById('desc-overlay').style.display = 'none';
    }

  function openClaimModal() {
    document.getElementById('claim-modal').style.display = 'flex';
  }

  function closeClaimModal() {
    document.getElementById('claim-modal').style.display = 'none';
  }

  // Open claim modal
function openClaimModal() {
  const modal = document.getElementById('claim-modal');
  modal.style.display = 'flex';

  // Reset inputs and buttons
  document.getElementById('claim-first-name').value = '';
  document.getElementById('claim-last-name').value = '';
  const checkbox = document.getElementById('claim-confirm');
  checkbox.checked = false;

  const claimBtn = document.getElementById('claim-confirm-btn');
  claimBtn.disabled = true;
  claimBtn.style.opacity = '0.5';

  const cancelBtn = document.getElementById('claim-cancel-btn');

  // Event: checkbox toggles Claim button
  checkbox.onchange = () => {
    claimBtn.disabled = !checkbox.checked;
    claimBtn.style.opacity = checkbox.checked ? '1' : '0.5';
  };

  // Event: Cancel closes modal
  cancelBtn.onclick = () => {
    modal.style.display = 'none';
  };
}

// Enable Claim button only if checkbox is checked
document.addEventListener("DOMContentLoaded", () => {
  const checkbox = document.getElementById('claim-confirm');
  const claimBtn = document.getElementById('claim-confirm-btn');
  const cancelBtn = document.getElementById('claim-cancel-btn');

  // Update Claim button state when checkbox changes
  checkbox.addEventListener('change', () => {
    claimBtn.disabled = !checkbox.checked;
    claimBtn.style.opacity = checkbox.checked ? '1' : '0.5';
  });

  // Cancel button closes modal
  cancelBtn.addEventListener('click', () => {
    document.getElementById('claim-modal').style.display = 'none';
  });
});

  </script>
</body>
</html>
