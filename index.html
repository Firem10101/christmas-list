<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Christmas List</title>

  <style>
  /* ===== Base Styles ===== */
  body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    background: url('https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.farmersalmanac.com%2Fwp-content%2Fuploads%2F2020%2F12%2FChristmas-Day-traditions-as_301005745.jpeg&f=1&nofb=1&ipt=5fec5f3eb60804cbac6eca77e3c7e28cc891b8d7a68c09544289a484bcb9bf56') no-repeat center center fixed;
    background-size: cover;
    color: #fff;
  }

  h1, h2 {
    text-align: center;
    text-shadow: 0.2vw 0.2vw 0.4vw #000;
    margin: 2vh 0;
    font-size: 2.5vw;
  }

  /* ===== List Container ===== */
  #list {
    width: 50%; /* Adjust this for how wide you want the list (40–60% looks good) */
    margin: 2% 0 2% 5%; /* Top, Right, Bottom, Left — pushes it a little from the left edge */
    padding: 2%;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 1.5vw;
    }

  /* ===== Item Cards ===== */
  .item {
    border: 0.2vw solid #fff;
    border-radius: 1vw;
    padding: 2%;
    margin: 2% 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: rgba(255, 0, 0, 0.3);
    transition: transform 0.2s, background-color 0.2s;
  }

  .item button {
    margin-right: 1%;      /* Tiny space between buttons */
    padding: 0.5% 2%;      /* Slightly smaller padding */
    font-size: 1.5vw;      /* Smaller text */
    flex: none;            /* Prevent buttons from stretching */
    }

  .item:hover {
    transform: scale(1.03);
    background-color: rgba(0, 128, 0, 0.3);
  }

  /* ===== Images ===== */
  .item img {
  width: 25%;                /* was 12%, now twice as large */
  max-width: 200px;          /* caps the size so it doesn’t blow up too big */
  height: auto;
  margin-right: 2%;
  border-radius: 0.8vw;
  object-fit: cover;
  align-self: center;        /* centers image vertically inside flex container */
  transition: transform 0.2s;
}

  .item img:hover {
    transform: scale(1.2);
    cursor: zoom-in;
  }

  /* ===== Buttons & Inputs ===== */
  button {
    padding: 1% 3%;
    background-color: gold;
    border: none;
    border-radius: 0.7vw;
    cursor: pointer;
    font-weight: bold;
    font-size: 2vw;
    transition: background-color 0.2s;
  }

  button:hover {
    background-color: #ffa500;
  }

  input {
    padding: 1%;
    margin: 1%;
    border-radius: 0.5vw;
    border: 0.1vw solid #ccc;
    font-size: 1vw;
  }

  h2 {
    margin-top: 5vh;
    font-size: 2vw;
  }

  /* ===== Snow Effect ===== */
  #snow {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
  }

  .snowflake {
    position: absolute;
    top: -2vh;
    color: white;
    font-size: 1.2vw;
    user-select: none;
    pointer-events: none;
    animation-name: fall;
    animation-timing-function: linear;
  }

  @keyframes fall {
    to { transform: translateY(100vh); }
  }

  /* ===== Admin Panels ===== */
  #admin-login, 
  #admin-section {
    position: fixed;
    top: 1.5vh;
    right: 2vw;
    background-color: rgba(0, 0, 0, 0.7);
    padding: 2%;
    border-radius: 1vw;
    width: 15vw;
    font-size: 0.5vw;
    box-shadow: 0 0 1vw rgba(0,0,0,0.5);
    z-index: 10000;
  }

  #admin-login input, 
  #admin-section input {
    width: 100%;
    font-size: 0.9vw;
    margin: 1vh 0;
  }

  #admin-login button, 
  #admin-section button {
    width: 100%;
    font-size: 1vw;
    padding: 1vh;
  }

  /* ===== Lightbox Overlay ===== */
  #lightbox {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
  }

  #lightbox img {
    max-width: 90%;
    max-height: 90%;
    border-radius: 1vw;
    box-shadow: 0 0 1.5vw #000;
  }

  #lightbox-close {
    position: absolute;
    top: 2vh;
    right: 4vw;
    color: #fff;
    font-size: 3vw;
    cursor: pointer;
  }

  /* ===== Description Overlay ===== */
  #desc-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10001;
  }

  #desc-box {
    background: rgba(255,255,255,0.95);
    color: #000;
    padding: 3%;
    border-radius: 1vw;
    max-width: 40vw;
    text-align: center;
    position: relative;
  }

  #desc-close {
    font-size: 2vw;
    font-weight: bold;
    cursor: pointer;
  }

  .description-text {
    font-style: italic;
    text-decoration: underline;
    color: #fff;
    background: none;
    border: none;
    cursor: pointer;
    margin-left: 2%;
    font-size: 1vw;
  }

  .description-text:hover {
    color: #ff0;
  }

  #desc-content pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    color: black;
    font-size: 1vw;
    font-family: inherit;
    margin: 0;
  }

  #claim-modal #claim-confirm-btn,
  #claim-modal #claim-cancel-btn {
    position: relative;
    top: 1.3em; /* moves them visually down */
    }



    </style>
  </head>
<body>
  <div id="snow"></div>

  <h1>Brandon's Birthday / Christmas List</h1>

  <!-- ===== Admin Login ===== -->
  <div id="admin-login">
    <input type="password" id="admin-password" placeholder="Admin Password" style="text-align: center;">
    <button onclick="toggleAdmin()">Enter Admin Mode</button>
  </div>

  <!-- ===== Admin Section ===== -->
  <div id="admin-section" style="display: none;">
    <h2>Add New Item</h2>
    <input type="text" id="item-name" placeholder="Item Name">
    <input type="text" id="item-price" placeholder="Price">
    <input type="file" id="item-image">
    <button onclick="addItem()">Add Item</button>
    <button id="exit-admin-btn" onclick="exitAdmin()">Exit Admin Mode</button>
  </div>

  <!-- ===== Public List ===== -->
  <div id="list"></div>
  <div id="loading-screen">
    <div class="loader"></div>
  </div>


  <!-- ===== Firebase SDKs ===== -->
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-database-compat.js"></script>

  <!-- ===== Lightbox Overlay ===== -->
  <div id="lightbox" style="display:none;">
    <span id="lightbox-close">&times;</span>
    <img id="lightbox-img" src="">
  </div>

  <!-- Description Overlay -->
    <div id="desc-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background-color: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000;">
    <div id="desc-box" style="background-color:white; padding:20px; border-radius:10px;
        max-width:400px; width:90%; text-align:left;">
        <!-- Main description box -->
        <div id="desc-content" style="margin-bottom:10px; border:1px solid #ccc; padding:10px;
        border-radius:5px; background-color:#f8f8f8; white-space:pre-wrap; word-wrap:break-word;"></div>
        
        <!-- Link box -->
        <div id="desc-link" style="border:1px solid #ccc; padding:10px; border-radius:5px;
        background-color:#eef; text-align:center;"></div>
        <button id="desc-close" onclick="closeDescOverlay()" style="margin-top:10px; padding:5px 10px; font-size:0.9em;">Close</button>
    </div>
    </div>

        <!-- Claim Modal -->
<div id="claim-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:10002;">
  <div style="background:#fff; color:#000; padding:20px; border-radius:10px; max-width:350px; width:90%; position:relative;">
    <h2>Claim Item</h2>
    <p>Please enter your information:</p>

    <div style="border:1px solid #ccc; border-radius:5px; padding:10px; background:#eef; text-align:center; margin:10px 0;">
      Please Note: By claiming an item, it will remove the item from the list and you will no longer be able to view it. Please make sure you save the link or details before claiming.
    </div>
    
    <input type="text" id="claim-first-name" placeholder="First Name" style="width:95%; margin-bottom:10px; padding:5px;"><br>
    <input type="text" id="claim-last-name" placeholder="Last Name" style="width:95%; margin-bottom:10px; padding:5px;"><br>
    
    <label style="display:flex; align-items:center; margin-bottom:15px;">
      <input type="checkbox" id="claim-confirm" style="margin-right:10px;">
      <span>
        Checking this box means you’re reserving this gift for me so others won’t purchase the same item.
        Note: this will not buy or order the item. It only marks it as claimed.
      </span>
    </label>
    
    <div style="display:flex; justify-content:flex-end; gap:10px; position:absolute; bottom:20px; right:20px; width:auto;">
  <button id="claim-confirm-btn" disabled style="opacity:0.5; width:auto; padding:0.6em 1.2em; font-size:0.7rem; white-space:nowrap; box-sizing:border-box;">Claim</button>
  <button id="claim-cancel-btn"style="width:auto; padding:0.6em 1.2em; font-size:0.7rem; white-space:nowrap; box-sizing:border-box;">Cancel</button>

    </div>
  </div>
</div>

<!-- Claim Success Overlay -->
<div id="claim-success-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background-color: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:10003;">
  <div style="background-color:rgb(255, 255, 255); padding:20px; border-radius:10px; max-width:400px; width:90%; text-align:center; position:relative;">
    <h2 style="color: rgb(0, 0, 0); font-size: 36px; font-family: Arial, sans-serif;">Claim Successful!</h2>
    <button id="claim-success-close"style="width:auto; padding:0.6em 1.2em; font-size:0.7rem; white-space:nowrap; box-sizing:border-box;">Close</button>
  </div>
</div>

<div style="width:50%; margin: -1.5% 0 2% 5%;">
  <button id="general-donate-btn" style="width:auto; font-size:1.2vw; padding:0.5em 0.7em;">Donate Money Instead</button>
</div>

<!-- Donate Modal -->
<div id="donate-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:10004;">
  <div style="background:#fff; color:#000; padding:20px; border-radius:10px; max-width:400px; width:90%; position:relative;">
    
    <!-- Title -->
    <h2 style="text-align:center; margin-top:0;">Donate</h2>
    
    <!-- Item Info / Donation Purpose -->
    <p id="donate-item-text" style="text-align:center; margin:5px 0; font-size:1rem;">A General Donation For Any Gift</p>
    
    <!-- Instruction Box -->
    <div style="border:1px solid #ccc; border-radius:5px; padding:10px; background:#eef; text-align:center; margin:10px 0;">
      This option is for anyone who doesn’t want to claim a gift item, but would still like to contribute a little something.
      Note: These donations are anonymous.
    </div>
    
    <!-- Input Box -->
    <input type="number" id="donate-amount" placeholder="$0.00" style="width:90%; margin:10px auto; display:block; padding:10px; font-size:1rem; text-align:center; border-radius:5px; border:1px solid #ccc;">
    
    <!-- Checkbox -->
    <label style="display:flex; align-items:center; margin:10px 0; font-size:0.9rem;">
      <input type="checkbox" id="donate-confirm" style="margin-right:10px;">
      <span>Checking this box just notes your intention to give this amount as a future gift. Nothing is charged or sent at this time.</span>
    </label>
    
    <!-- Buttons -->
    <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:10px;">
      <button id="donate-confirm-btn" disabled style="opacity:0.5; width:auto; padding:0.6em 1.2em; font-size:0.7rem; white-space:nowrap; box-sizing:border-box;">Donate</button>
      <button id="donate-cancel-btn" style="width:auto; padding:0.6em 1.2em; font-size:0.7rem; white-space:nowrap; box-sizing:border-box;">Cancel</button>
    </div>
  </div>
</div>

<div id="donation-total" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: rgba(0,0,0,0.7);
    color: #fff;
    padding: 10px 15px;
    border-radius: 10px;
    font-size: 1.2rem;
    font-weight: bold;
    z-index: 10005;
">
  Total Donated: $0.00
</div>

<!-- Donation Success Overlay -->
<div id="donate-success-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background-color: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:10006;">
  <div style="background-color:#fff; padding:20px; border-radius:10px; max-width:400px; width:90%; text-align:center; position:relative;">
    <h2 style="color:#000; font-size:36px; font-family: Arial, sans-serif;">Donation Successful!</h2>
    <p id="donate-success-subtitle" style="color:#000; font-size:1.2rem; margin:10px 0;"></p>
    <button id="donate-success-close" style="width:auto; padding:0.6em 1.2em; font-size:0.7rem; white-space:nowrap; box-sizing:border-box;">Close</button>
  </div>
</div>


<style>
/* ===== Loader (Hidden by Default) ===== */
#loading-screen {
  display: flex; /* changed from absolute/flex combo */
  justify-content: center;
  align-items: center;
  position: fixed; /* make sure it overlays the entire screen */
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
  z-index: 1000; /* above everything */
}

.loader {
  border: 6px solid #f3f3f3;
  border-top: 6px solid #3498db;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ===== Improved Mobile Scaling ===== */
@media (max-width: 768px) {
  body {
    font-size: 0.9rem;
  }

  #list {
    width: 90%;
    margin: 5% auto;
    padding: 4%;
    background: rgba(0, 0, 0, 0.6); /* same black transparent background as desktop */
    border-radius: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    gap: 3%;
  }

  .item {
    display: flex;
    flex-direction: column; /* stack main sections vertically */
    align-items: center;
    justify-content: center;
    gap: 3vw;
    padding: 4%;
    border-radius: 12px;
  }

  /* Top section: image + name/cost side by side */
  .item-top {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: flex-start;
    width: 100%;
    background-color: rgba(255, 0, 0, 0.3);
    gap: 4%;
  }

  .item-top img {
    width: 28%;
    max-width: 140px;
    height: auto;
  }

  .item-top div {
    flex: 1;
    font-size: 4vw;
    white-space: nowrap;
  }

  /* Buttons stacked below */
  .item button,
  .description-text {
    font-size: 4vw;
    padding: 3% 5%;
    width: 85%;
    border-radius: 10px;
    text-align: center;
  }

  .description-text {
    margin-top: 2%;
  }

  input {
    font-size: 4.5vw;
    width: 95%;
  }

  #claim-modal div {
    width: 90%;
    max-width: 350px;
  }

  /* Fix checkbox text alignment on mobile */
    #claim-modal label,
  #donate-modal label,
  .checkbox-container {
    display: inline-flex !important;      /* inline so it only takes needed width */
    align-items: center !important;
    justify-content: flex-start !important;
    gap: 8px !important;
    width: auto !important;               /* prevent stretching */
    max-width: 100%;                      /* avoid overflow */
    text-align: left !important;
    flex-wrap: wrap !important;           /* allow wrapping if text is long */
  }

  #claim-modal input[type="checkbox"],
  #donate-modal input[type="checkbox"],
  .checkbox-container input[type="checkbox"] {
    flex: 0 0 auto !important;            /* don’t let checkbox expand */
    width: 20px !important;
    height: 20px !important;
    margin: 0 !important;
  }

  #claim-modal label span,
  #donate-modal label span,
  .checkbox-container label span {
    flex: 1 1 auto !important;
    white-space: normal !important;
    line-height: 1.4 !important;
    word-break: break-word !important;
  }

  #loading-screen {
    display: flex;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.4);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }

  #desc-content pre {
    font-size: 1rem; /* bigger on mobile */
  }

  #admin-login,
  #admin-section {
    display: none !important;
  }

  #general-donate-btn {
    font-size: 3vw !important;       /* same as claim button */
    padding: 3% 5% !important;       /* same as claim button */
    width: 85% !important;           /* match claim buttons */
    border-radius: 10px !important;
    max-width: 300px;     /* optional cap */
  }

  /* Donation modal inputs and buttons bigger for mobile */
    .checkbox-container {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 8px;
    width: 100%;
    text-align: left;
    flex-wrap: wrap; /* allow text to wrap nicely on small screens */
  }

  .checkbox-container input[type="checkbox"] {
    flex: 0 0 auto; /* prevent checkbox from stretching */
    width: 20px;    /* standard checkbox size */
    height: 20px;
    margin: 0;
  }

  .checkbox-container label {
    flex: 1; /* take remaining space */
    white-space: normal; /* allow wrapping */
    word-break: break-word;
    line-height: 1.4;
  }

    #list-title {
    font-size: 2.2rem !important;
    font-weight: bold !important;
    text-align: center !important;
    margin-bottom: 1rem !important;
  }

  /* Modal titles */
  .modal h2 {
    font-size: 1.6rem !important;
    font-weight: bold !important;
    margin-bottom: 0.8rem !important;
    text-align: center !important;
  }

  #claim-modal h2,
  #donate-modal h2 {
    font-size: 2.2rem !important;   /* choose the size you want */
    text-align: center !important;
    font-weight: bold !important;
  }
}

</style>

<script>
  let currentItemKey = null; // Tracks which item is being claimed
  let isAdmin = false;

  /* ===== Firebase Configuration ===== */
  const firebaseConfig = {
    apiKey: "AIzaSyARtsrEkiRqyxEv6KfdC48TJt1RCcZZ_Kg",
    authDomain: "christmas-list-9a41e.firebaseapp.com",
    databaseURL: "https://christmas-list-9a41e-default-rtdb.firebaseio.com",
    projectId: "christmas-list-9a41e",
    storageBucket: "christmas-list-9a41e.appspot.com",
    messagingSenderId: "590904557299",
    appId: "1:590904557299:web:d6989710fe9049637fc186"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const itemsRef = db.ref('items');
  const claimedRef = db.ref('claimedItems');
  const totalRef = db.ref('totalDonations');
  const donationTotalDiv = document.getElementById('donation-total');
  const totalBox = document.getElementById('total-box');

  /* ===== Realtime Firebase Sync ===== */
  itemsRef.on('value', snapshot => {
  const data = snapshot.val();
  const items = data ? Object.entries(data).map(([key, value]) => ({ key, ...value })) : [];
  items.sort((a, b) => (a.order ?? 0) - (b.order ?? 0));
  renderList(items);

  // Hide loading screen after items are rendered
  const loader = document.getElementById('loading-screen');
  if (loader) loader.style.display = 'none';
});


  claimedRef.on('value', snapshot => {
    const data = snapshot.val();
    const items = data ? Object.entries(data).map(([key, value]) => ({ key, ...value })) : [];
    renderClaimedList(items);
  });

  /* ===== Render Items ===== */
  function renderList(items) {
    const listDiv = document.getElementById('list');
    listDiv.innerHTML = '';

    items.forEach(item => {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'item';

      // Image
      const img = document.createElement('img');
      img.src = item.image || '';
      itemDiv.appendChild(img);

      // Lightbox
      img.addEventListener('click', () => {
        document.getElementById('lightbox').style.display = 'flex';
        document.getElementById('lightbox-img').src = img.src;
      });

      // Text
      const text = document.createElement('div');
      text.innerHTML = `<strong>${item.name}</strong><br>$${item.price}`;
      itemDiv.appendChild(text);

      // Description Button
      const descBtn = document.createElement('button');
      descBtn.className = 'description-text';
      descBtn.textContent = 'description';
      descBtn.onclick = () => showDescription(item);
      itemDiv.appendChild(descBtn);

      // Claim Button
      const claimBtn = document.createElement('button');
      claimBtn.textContent = 'Claim';
      claimBtn.onclick = () => {
        currentItemKey = item.key;
        openClaimModal();
      };
      itemDiv.appendChild(claimBtn);

      listDiv.appendChild(itemDiv);
    });
  }

  function showDescription(item) {
    const desc = item.description || 'No description available.';
    document.getElementById('desc-content').innerHTML = `<pre>${desc}</pre>`;

    const linkBox = document.getElementById('desc-link');
    if (item.link) {
      linkBox.innerHTML = `<a href="${item.link}" target="_blank">${item.link}</a>`;
    } else {
      const linkMatch = desc.match(/https?:\/\/\S+/);
      linkBox.innerHTML = linkMatch ? `<a href="${linkMatch[0]}" target="_blank">${linkMatch[0]}</a>` : '<em>No link provided</em>';
    }

    document.getElementById('desc-overlay').style.display = 'flex';
  }

  /* ===== Render Claimed Items ===== */
  function renderClaimedList(items) {
    const claimedContainer = document.getElementById('claimed-items-container');
    claimedContainer.innerHTML = '';
    items.forEach(item => {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'item';

      if (item.image) {
        const img = document.createElement('img');
        img.src = item.image;
        itemDiv.appendChild(img);
      }

      const textDiv = document.createElement('div');
      textDiv.innerHTML = `<strong>${item.name}</strong><br>$${item.price}<br><em>Claimed by: ${item.claimedBy || item.firstName + ' ' + item.lastName}</em>`;
      itemDiv.appendChild(textDiv);

      claimedContainer.appendChild(itemDiv);
    });
  }

  /* ===== Add New Item ===== */
  function addItem() {
    if (!isAdmin) return alert("Only admin can add items!");
    const name = document.getElementById('item-name').value;
    const price = document.getElementById('item-price').value;
    const imageInput = document.getElementById('item-image');

    if (!name || !price) return alert('Please enter name and price');

    const reader = new FileReader();
    reader.onload = function(e) {
      const newItem = { name, price, image: e.target.result, order: Date.now() };
      itemsRef.push(newItem);
    };

    if (imageInput.files[0]) {
      reader.readAsDataURL(imageInput.files[0]);
    } else {
      itemsRef.push({ name, price, image: '', order: Date.now() });
    }

    document.getElementById('item-name').value = '';
    document.getElementById('item-price').value = '';
    imageInput.value = '';
  }

  /* ===== Admin Login ===== */
  function toggleAdmin() {
    const passwordInput = document.getElementById('admin-password');
    const password = passwordInput.value;
    const adminButton = document.querySelector('#admin-login button');

    if (password === '0825') {
      isAdmin = true;
      window.location.href = 'admin.html';
    } else {
      const originalColor = adminButton.style.backgroundColor;
      const originalText = adminButton.textContent;
      adminButton.style.backgroundColor = 'red';
      adminButton.textContent = 'Wrong password';
      setTimeout(() => {
        adminButton.style.backgroundColor = originalColor || 'gold';
        adminButton.textContent = originalText;
      }, 500);
    }
  }

  function exitAdmin() {
    isAdmin = false;
    document.getElementById('admin-section').style.display = 'none';
    document.getElementById('admin-login').style.display = 'block';
  }

  /* ===== Snow Animation ===== */
  function createSnowflake() {
    const snowflake = document.createElement('div');
    snowflake.className = 'snowflake';
    snowflake.style.left = Math.random() * window.innerWidth + 'px';
    snowflake.style.fontSize = (Math.random() * 10 + 10) + 'px';
    snowflake.style.opacity = Math.random();
    snowflake.style.animationDuration = (Math.random() * 5 + 5) + 's';
    snowflake.textContent = '❄';
    document.getElementById('snow').appendChild(snowflake);
    setTimeout(() => snowflake.remove(), 10000);
  }
  setInterval(createSnowflake, 200);

  /* ===== Lightbox Controls ===== */
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-img');
  const lightboxClose = document.getElementById('lightbox-close');

  lightboxClose.addEventListener('click', () => lightbox.style.display = 'none');
  lightbox.addEventListener('click', e => { if (e.target === lightbox) lightbox.style.display = 'none'; });

  /* ===== Description Overlay Controls ===== */
  document.getElementById("desc-close").addEventListener("click", () => document.getElementById("desc-overlay").style.display = "none");
  window.addEventListener("click", e => { if (e.target === document.getElementById("desc-overlay")) document.getElementById("desc-overlay").style.display = "none"; });

  /* ===== Claim Modal ===== */
  function openClaimModal() {
    const modal = document.getElementById('claim-modal');
    modal.style.display = 'flex';
    document.getElementById('claim-first-name').value = '';
    document.getElementById('claim-last-name').value = '';
    const checkbox = document.getElementById('claim-confirm');
    checkbox.checked = false;

    const claimBtn = document.getElementById('claim-confirm-btn');
    claimBtn.disabled = true;
    claimBtn.style.opacity = '0.5';

    checkbox.onchange = () => {
      claimBtn.disabled = !checkbox.checked;
      claimBtn.style.opacity = checkbox.checked ? '1' : '0.5';
    };

    document.getElementById('claim-cancel-btn').onclick = () => modal.style.display = 'none';
  }

  document.getElementById('claim-confirm-btn').addEventListener('click', async () => {
    const firstName = document.getElementById('claim-first-name').value.trim();
    const lastName = document.getElementById('claim-last-name').value.trim();
    const confirmBox = document.getElementById('claim-confirm');

    if (!firstName || !lastName || !confirmBox.checked || !currentItemKey) return alert("Please fill out all fields and check the box.");

    const itemRef = firebase.database().ref('items/' + currentItemKey);
    const snapshot = await itemRef.once('value');
    const itemData = snapshot.val();
    if (!itemData) return alert("Error: Item not found.");

    await claimedRef.push({ 
        ...itemData, 
        firstName, 
        lastName, 
        claimedBy: `${firstName} ${lastName}`, 
        claimedAt: Date.now() 
    });
    await itemRef.remove();

    document.getElementById('claim-modal').style.display = 'none';
    document.getElementById('claim-first-name').value = '';
    document.getElementById('claim-last-name').value = '';
    document.getElementById('claim-confirm').checked = false;
    document.getElementById('claim-confirm-btn').disabled = true;
    document.getElementById('claim-confirm-btn').style.opacity = '0.5';

    const claimedBy = `${firstName} ${lastName}`;
    const successOverlay = document.getElementById('claim-success-overlay');
    successOverlay.style.display = 'flex';
    document.getElementById('claim-success-close').addEventListener('click', () => {
    document.getElementById('claim-success-overlay').style.display = 'none';
    });
  });

  // Close button for success overlay
document.getElementById('claim-success-close').addEventListener('click', () => {
    document.getElementById('claim-success-overlay').style.display = 'none';
});

// Open general donation modal
document.getElementById('general-donate-btn').addEventListener('click', () => {
  const modal = document.getElementById('donate-modal');
  modal.style.display = 'flex';

  const amountInput = document.getElementById('donate-amount');
  amountInput.value = '';

  const checkbox = document.getElementById('donate-confirm');
  checkbox.checked = false;

  const donateBtn = document.getElementById('donate-confirm-btn');
  donateBtn.disabled = true;
  donateBtn.style.opacity = '0.5';

  // Enable Donate button only when checkbox is checked
  checkbox.onchange = () => {
    donateBtn.disabled = !checkbox.checked;
    donateBtn.style.opacity = checkbox.checked ? '1' : '0.5';
  };

  donateBtn.onclick = () => {
    const amount = parseFloat(amountInput.value);
    if (isNaN(amount) || amount <= 0) return alert("Please enter a valid donation amount.");

    // Update Firebase total atomically
    totalRef.transaction(currentTotal => (currentTotal || 0) + amount);

    // Log individual donation
    db.ref('donations').push({ amount, timestamp: Date.now() });

    // Show donation success overlay
    const donateOverlay = document.getElementById('donate-success-overlay');
    const donateSubtitle = document.getElementById('donate-success-subtitle');
    donateSubtitle.textContent = `Thank you so much for donating $${amount.toFixed(2)}!`;
    donateOverlay.style.display = 'flex';

    document.getElementById('donate-success-close').onclick = () => {
        donateOverlay.style.display = 'none';
    };

    // Close the donate modal
    modal.style.display = 'none';
};

  // Cancel button
  document.getElementById('donate-cancel-btn').onclick = () => modal.style.display = 'none';
});


// listen for updates from Firebase
totalRef.on('value', snapshot => {
    const total = snapshot.val() || 0;
    donationTotalDiv.textContent = `Total Donated: $${parseFloat(total).toFixed(2)}`;
});

// when a donation is made
document.getElementById('donate-confirm-btn').onclick = () => {
    const amount = parseFloat(document.getElementById('donate-amount').value);
    if (isNaN(amount) || amount <= 0) return alert("Please enter a valid donation amount.");

    // update total in Firebase atomically
    totalRef.transaction(currentTotal => (currentTotal || 0) + amount);

    // optionally log individual donation
    db.ref('donations').push({ amount, timestamp: Date.now() });

    alert(`Thank you for donating $${amount.toFixed(2)}!`);
    document.getElementById('donate-modal').style.display = 'none';
};

</script>
</body>
</html>